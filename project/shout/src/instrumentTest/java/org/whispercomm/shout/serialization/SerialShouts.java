
package org.whispercomm.shout.serialization;

import java.security.spec.InvalidKeySpecException;

import org.joda.time.DateTime;
import org.joda.time.DateTimeZone;
import org.spongycastle.util.encoders.Hex;
import org.whispercomm.shout.ShoutImage;
import org.whispercomm.shout.Hash;
import org.whispercomm.shout.HashReference;
import org.whispercomm.shout.Shout;
import org.whispercomm.shout.SimpleHashReference;
import org.whispercomm.shout.User;
import org.whispercomm.shout.crypto.ECPublicKey;
import org.whispercomm.shout.crypto.KeyGenerator;
import org.whispercomm.shout.test.util.TestShout;
import org.whispercomm.shout.test.util.TestUser;

public class SerialShouts {

	/*
	 * Key material for users
	 */
	private static String CHILD_PUBLIC_KEY = "3059301306072A8648CE3D020106082A8648CE3D0301070342000474BC24849CF115A40665C465F8EE11D42C7F3ABBC61602DC5FB1FD8C05649A92B5D6987652AACA7FAA6D161CCDCC272C02F3520BFF753D5FDDD08C1C4D70B07B";
	@SuppressWarnings("unused")
	// Keep to regenerate signature
	private static String CHILD_PRIVATE_KEY = "308193020100301306072A8648CE3D020106082A8648CE3D030107047930770201010420DE48DD0A4DD3A3D9D9030F47CF069829055611F5D6FF06D03BAF8F7A72DDA969A00A06082A8648CE3D030107A1440342000474BC24849CF115A40665C465F8EE11D42C7F3ABBC61602DC5FB1FD8C05649A92B5D6987652AACA7FAA6D161CCDCC272C02F3520BFF753D5FDDD08C1C4D70B07B";
	private static HashReference<ShoutImage> CHILD_AVATAR_HASH = new SimpleHashReference<ShoutImage>(
			new Hash(new byte[] {
					0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
					0, 0, 0, 0, 0, 0,
			}));

	private static String PARENT_PUBLIC_KEY = "3059301306072A8648CE3D020106082A8648CE3D0301070342000434160B8041501DF3D5423D6F63C6C5E387290CFB0232EB5C988960C167A010EE5AD6D163F2BAF70733DAC9B46D07F01F72EF8C8AC9BDA4A206EBAE880A6338BA";
	@SuppressWarnings("unused")
	// Keep to regenerate signature
	private static String PARENT_PRIVATE_KEY = "308193020100301306072A8648CE3D020106082A8648CE3D0301070479307702010104203A84141D31C579FCFB730E0B0E54E9BBF5E86E8A3B9E7CAC82F2752168AF861DA00A06082A8648CE3D030107A1440342000434160B8041501DF3D5423D6F63C6C5E387290CFB0232EB5C988960C167A010EE5AD6D163F2BAF70733DAC9B46D07F01F72EF8C8AC9BDA4A206EBAE880A6338BA";
	private static HashReference<ShoutImage> PARENT_AVATAR_HASH = new SimpleHashReference<ShoutImage>(
			new Hash(new byte[] {
					0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
					0, 0, 0, 0, 0, 0,
			}));
	
	private static String GRANDPARENT_PUBLIC_KEY = "3059301306072A8648CE3D020106082A8648CE3D030107034200045F36A31792965FC24B2BBC0EAD43F6228DE7B9BFA2B34AC6C47B143EBFB167E927B1A6427CFAF403D4275C709DE23F912576D1137E015A36A0C611558B378FCE";
	@SuppressWarnings("unused")
	// Keep to regenerate signature
	private static String GRANDPARENT_PRIVATE_KEY = "308193020100301306072A8648CE3D020106082A8648CE3D030107047930770201010420CF1DF8F8BBFF54FA37D42E9BA2493434A060A3DD3E27DC3C89DFE230EFAF90BBA00A06082A8648CE3D030107A144034200045F36A31792965FC24B2BBC0EAD43F6228DE7B9BFA2B34AC6C47B143EBFB167E927B1A6427CFAF403D4275C709DE23F912576D1137E015A36A0C611558B378FCE";
	private static HashReference<ShoutImage> GRANDPARENT_AVATAR_HASH = new SimpleHashReference<ShoutImage>(
			new Hash(new byte[] {
					0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
					0, 0, 0, 0, 0, 0,
			}));
	
	/*
	 * Users
	 */
	private static User CHILD_USER = new TestUser("IAmTheChild ٩(͡๏̯͡๏)۶",
			generatePublic(CHILD_PUBLIC_KEY), CHILD_AVATAR_HASH);

	private static User PARENT_USER = new TestUser(
			"IAmTheParent ٩(-̮̮̃•̃)", generatePublic(PARENT_PUBLIC_KEY), PARENT_AVATAR_HASH);

	private static User GRANDPARENT_USER = new TestUser(
			"IAmTheGrandparent ٩(-̮̮̃-̃)۶",
			generatePublic(GRANDPARENT_PUBLIC_KEY), GRANDPARENT_AVATAR_HASH);

	/*
	 * Shouts
	 */
	public static Shout GRANDPARENT = new TestShout(
			GRANDPARENT_USER,
			null,
			"٩(-̮̮̃-̃)۶: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus congue rutrum quam quis sollicitudin.",
			new DateTime(2010, 9, 8, 7, 6, 5, DateTimeZone.UTC),
			null,
			new Hash(Hex.decode("9C019522796E25E742AEDFBA0844A1EF344F4897F88BFABD39365A553941F137")), null);

	public static Shout PARENT = new TestShout(
			PARENT_USER,
			GRANDPARENT,
			"٩(-̮̮̃•̃): Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse potenti. Etiam a dui ut dolor pellentesque faucibus in vitae nibh.",
			new DateTime(2011, 10, 9, 8, 7, 6, 5, DateTimeZone.UTC),
			null,
			new Hash(Hex.decode("1A604881053AE042E1A5DC02ED0D275B9206AF00EDE5399739510B91CDC348E8")), null);

	public static Shout CHILD = new TestShout(
			CHILD_USER,
			PARENT,
			"٩(͡๏̯͡๏)۶: Sed vehicula placerat velit, sed pretium lacus luctus tincidunt. Vestibulum suscipit elit et turpis tristique lobortis.",
			new DateTime(2012, 11, 10, 9, 8, 7, DateTimeZone.UTC),
			null,
			new Hash(Hex.decode("B2E74FC24E02A31CF8DF4F2826F2CD0E97B68F876E3AC85A30E51F9A26A144EB")), null);

	/*
	 * Serialized Shouts
	 */
	private static String GRANDPARENT_SERIALIZED_STRING = stripPipes("00|0000012AF02A6748|22|49416d5468654772616e64706172656e7420d9a9282dccaeccaecc832dcc8329dbb6|"
			+ "3059301306072A8648CE3D020106082A8648CE3D030107034200045F36A31792965FC24B2BBC0EAD43F6228DE7B9BFA2B34AC6C47B143EBFB167E927B1A6427CFAF403D4275C709DE23F912576D1137E015A36A0C611558B378FCE|"
			+ "7A|d9a9282dccaeccaecc832dcc8329dbb63a204c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73656374657475722061646970697363696e6720656c69742e2050686173656c6c757320636f6e6775652072757472756d207175616d207175697320736f6c6c696369747564696e2e|"
			+ "|");

	private static String GRANDPARENT_SERIALIZED_SIGNED_STRING = stripPipes(GRANDPARENT_SERIALIZED_STRING
			+ "46|304402205fdfb5963542a59ebb68771063c3117d4a63b080743ce8707d53ab80a70c21ff02204a091e4394ab2b95c1eb201694f35ac84993e9b85a6b5fb78e009e3ba380e7a9");

	private static String PARENT_SERIALIZED_STRING = stripPipes("01|00000132E7B89415|1D|49416d546865506172656e7420d9a9282dccaeccaecc83e280a2cc8329|"
			+ "3059301306072A8648CE3D020106082A8648CE3D0301070342000434160B8041501DF3D5423D6F63C6C5E387290CFB0232EB5C988960C167A010EE5AD6D163F2BAF70733DAC9B46D07F01F72EF8C8AC9BDA4A206EBAE880A6338BA|"
			+ "99|d9a9282dccaeccaecc83e280a2cc83293a204c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73656374657475722061646970697363696e6720656c69742e2053757370656e646973736520706f74656e74692e20457469616d20612064756920757420646f6c6f722070656c6c656e74657371756520666175636962757320696e207669746165206e6962682e|"
			+ "9C019522796E25E742AEDFBA0844A1EF344F4897F88BFABD39365A553941F137|");

	private static String PARENT_SERIALIZED_SIGNED_STRING = stripPipes(PARENT_SERIALIZED_STRING
			+ "47|30450220453471c42d032fd8ee1708d70644da4c99c72f797479199796527172df0598d8022100af718b5e41e3f4437780ef57325dca25ff3ee35332f9539621e9e7d3cdab238b");

	private static String CHILD_SERIALIZED_STRING = stripPipes("01|0000013AE99378D8|1E|49416d5468654368696c6420d9a928cda1e0b98fccafcda1e0b98f29dbb6|"
			+ "3059301306072A8648CE3D020106082A8648CE3D0301070342000474BC24849CF115A40665C465F8EE11D42C7F3ABBC61602DC5FB1FD8C05649A92B5D6987652AACA7FAA6D161CCDCC272C02F3520BFF753D5FDDD08C1C4D70B07B|"
			+ "8B|d9a928cda1e0b98fccafcda1e0b98f29dbb63a20536564207665686963756c6120706c6163657261742076656c69742c20736564207072657469756d206c61637573206c75637475732074696e636964756e742e20566573746962756c756d20737573636970697420656c69742065742074757270697320747269737469717565206c6f626f727469732e|"
			+ "1A604881053AE042E1A5DC02ED0D275B9206AF00EDE5399739510B91CDC348E8|");

	private static String CHILD_SERIALIZED_SIGNED_STRING = stripPipes(CHILD_SERIALIZED_STRING
			+ "46|304402203e00d21a26028659e2c1b46a8fb27d0fe307204afe289d8ff74f588ddf372aef02206e559b2c993cd8928e67949241067957863d60a644c291325121b2244b8eec29");

	public static byte[] GRANDPARENT_SERIALIZED = Hex
			.decode(GRANDPARENT_SERIALIZED_STRING);

	public static byte[] GRANDPARENT_SIGNED = Hex
			.decode(GRANDPARENT_SERIALIZED_SIGNED_STRING);

	public static byte[] PARENT_SERIALIZED = Hex
			.decode(PARENT_SERIALIZED_STRING);

	public static byte[] PARENT_SIGNED = Hex
			.decode(PARENT_SERIALIZED_SIGNED_STRING);

	public static byte[] CHILD_SERIALIZED = Hex.decode(CHILD_SERIALIZED_STRING);

	public static byte[] CHILD_SIGNED = Hex
			.decode(CHILD_SERIALIZED_SIGNED_STRING);

	private static String stripPipes(String str) {
		return str.replace("|", "");
	}

	/*
	 * Key generation helper functions
	 */
	private static ECPublicKey generatePublic(String encodedKey) {
		try {
			return KeyGenerator.generatePublic(Hex.decode(encodedKey));
		} catch (InvalidKeySpecException e) {
			throw new RuntimeException(e);
		}
	}
}
